## Shimmy

Shake up your frontend.

### What?

Shimmy is a declarative frontend framework inspired by Svelte, Solid, Zustand, Deku, and most of all, jQuery. It's designed for web apps whose code is generated by an LLM in real time, but it works just fine for good old hand-written sites too. Its predictable, minimal structure is optimized for LLM composabilityâ€”just mash Tab in Cursor or VSCode and watch your app emerge.

---

### Simple Example

```
myproject/
  root/
    template.html
    logic.js
    store.js
```

At a minimum, a Shimmy project has one `template.html`, and optionally a `logic.js` and `store.js`. Here's a simple counter:

**template.html**
```html
<html>
  <body>
    <div>Here's a counter</div>
    <p data-s-id="count"></p>
    <button data-s-listen="click:increment">Increment</button>
  </body>
</html>
```

**logic.js**
```javascript
import $ from 'jquery'

export const increment = ({ root }, /* original event */) =>
  root.count += 1

export default function ({ count }, { root }) {
  $(count).text(root.count)
}
```

**store.js**
```javascript
export default {
  count: 0
};
```

Then run:
```bash
shimmy dev
```
And go to town!

> Note: All `$(id).is(...)` bindings are re-evaluated on any update to the referenced store(s). Shimmy does not track dependencies automaticallyâ€”re-evaluation happens by convention.

---

### File-System Based Routing

Like Vike or Next.js, Shimmy uses file-based routing:

```
/root
  _/
    template.html
    logic.js
    store.js
  /login
    template.html
    logic.js
    store.js
  /about
    template.html
```

- The `root` folder serves `/`
- `_` contains Shimmy files for that route
- Terminal routes don't need the `_` folder

This project serves:
- `/`
- `/login`
- `/about`

---

### `template.html`

Plain old HTML. Use `data-s-id` to identify elements and `data-s-listen="event:id"` for event handlers. Multiple listeners can be specified using space separation:

```html
<button data-s-listen="click:increment mouseenter:highlight mouseleave:unhighlight">
  Click or hover me
</button>
```

---

### `logic.js`

Contains all logic for your component. Named functions must be exported and always destructure their store args (e.g. `({ root })`). The default export is a DOM binding function:

```javascript
export default function (elements, stores, updateCount, inDom) {
  // ...
}
```

- `elements`: named elements
- `stores`: all scoped stores
- `updateCount`: starts at 0
- `inDom`: `true` if DOM-bound, `false` on the server

> Named functions **must** destructure their store argument. Otherwise, Shimmy throws a compiler error.

> Logic files must only include `import` statements, named function exports, and the default export function. Arbitrary code outside these constraints will raise a compiler error.

> Named elements aren't strictly necessary, but they allow you to avoid setting elements' `id` property, which can often cause naming conflicts in the DOM.

---

### `store.js`

Just stuff you want to store.

```javascript
export default {
  count: 0
}
```

You can also export multiple named stores from a single file:

```javascript
export const userStore = { name: '', email: '' }
export const statusStore = { status: '', lastUpdated: '' }
```

Handlers for each store must be exported in an array:

```javascript
import $ from 'jquery'

export default [
  function ({ userName, userEmail }, { user }) {
    $(userName).text(user.name)
    $(userEmail).text(user.email)
  },
  function ({ appStatus, lastUpdated }, { status }) {
    $(appStatus).text(status.status)
    $(lastUpdated).text(status.lastUpdated)
  }
]
```

Shimmy tracks the stores used by each handler and only calls it if the store is updated.

---

### Nested Components

Use brackets to embed components:

```html
<div>
  {left-panel}
  {center-panel}
  {right-panel}
</div>
```

Structure:
```
/root
  _/
    template.html
    /left-panel
      template.html
    /center-panel
      template.html
    /right-panel
      template.html
```

To reuse components, put them in `/components` and refer with an empty file named after the template:

```
/root
  _/
    template.html
    /left-panel
      panel
    /right-panel
      panel
/components
  /panel
    template.html
```

Shimmy-aware tooling can automatically infer component-store bindings by reading directory structure and file contents. LLMs using custom RAG setups can consume this structure as JSON for precise code generation.

---

### Multiple Stores

You can refer to any store in outer scope by name. Here's an example with local and global counters:

```
/root
  _/
    template.html
    logic.js
    store.js
    /left-counter
      counter
    /right-counter
      counter
/components
  /counter
    template.html
    logic.js
    store.js
```

**root/_/template.html**
```html
<html>
  <body>
    <h1>Total Increments: <span data-s-id="globalCount"></span></h1>
    <div>
      <h2>Left Counter</h2>
      {left-counter}
    </div>
    <div>
      <h2>Right Counter</h2>
      {right-counter}
    </div>
  </body>
</html>
```

**root/_/logic.js**
```javascript
import $ from 'jquery'

export default function ({ globalCount }, { root }) {
  $(globalCount).text(root.globalCount)
}
```

**root/_/store.js**
```javascript
export default {
  globalCount: 0
}
```

**components/counter/template.html**
```html
<div>
  <p>Local Count: <span data-s-id="localCount"></span></p>
  <button data-s-listen="click:incrementLocal">Increment Local</button>
</div>
```

**components/counter/logic.js**
```javascript
import $ from 'jquery'

export const incrementLocal = ({ local, root }) => {
  local.localCount += 1
  root.globalCount += 1
}

export default function ({ localCount }, { local }) {
  $(localCount).text(local.localCount)
}
```

**components/counter/store.js**
```javascript
export default {
  localCount: 0
}
```

---

### Tracking Store Changes

Want to combine or track updates across stores? Use:

- `store.changed` to see if anything changed
- Custom logic to diff previous and current values

---

### Lists of Components

Use an `Array` for lists of components.

In a template:

```html
<div>
  {root.friends:friend-presence:friend}
</div>
```

This says: use `friend-presence` to render each item in `root.friends`, passing it in as `friend`.

---

### Friends Example

```
/root
  _/
    template.html
    logic.js
    store.js
/components
  /friend-presence
    template.html
    logic.js
```

**/root/_/template.html**
```html
<html>
  <body>
    <h1>Friends Online</h1>
    <button data-s-listen="click:addRandomFriend">Add Random Friend</button>
    <div>
      {root.friends:friend-presence:friend}
    </div>
  </body>
</html>
```

**/root/_/logic.js**
```javascript
import { faker } from '@faker-js/faker'
import { nanoid } from 'nanoid'

export const addRandomFriend = ({ root }) => {
  root.friends.push({
    id: nanoid(),
    name: faker.person.fullName(),
    online: Math.random() > 0.5
  })
}
```

**/root/_/store.js**
```javascript
export default {
  friends: []
}
```

**/components/friend-presence/template.html**
```html
<div class="friend">
  <p>
    <strong data-s-id="name"></strong>
    <span data-s-id="status"></span>
  </p>
</div>
```

**/components/friend-presence/logic.js**
```javascript
import $ from 'jquery'

export default function ({ name, status }, { friend }) {
  $(name).text(friend.name)
  $(status).text(friend.online ? 'ðŸŸ¢ Online' : 'ðŸ”´ Offline')
}
```

---

### Portals

Sometimes, you need a stateful component that can be passed around to multiple parts of the app. Use `shimmy-pub` for this, giving the element a name, for example `myVideo`. Then, the element in the portal becomes part of your store at `myVideo`, and you can pass it wherever you want.

For example, if you have:

```html
<shimmy-pub name="myVideo">
  <video />
</shimmy-pub>
```

Then your store will automatically have a `myVideo` key that points to the `HTMLVideoElement`.

To embed this element in html, you can use `shimmy-sub`.

```html
<shimmy-sub id="video-sub" name="myVideo">
</shimmy-sub>
```

In `logic.js`, you can call `$(videoSub).steal()` to beam the component to the `shimmy-sub` and `$(videoSub).relinquish()` to remove the component.

If there are multiple `shimmy-sub` targets, `steal()` sends the component to all active subs, with the last one taking precedence.

